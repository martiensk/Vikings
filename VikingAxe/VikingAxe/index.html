<!DOCTYPE html>
<html>
<head>
    <title>test</title>
	<meta charset="utf-8" />
    <!--<script src="three/src/Three.js"></script>-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
    <script src="scripts/TrackballControls.js"></script>
    <script src="scripts/ColladaLoader.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.4/dat.gui.min.js"></script>
    <style>
        html, body{
            margin:0;
            padding:0;
            width:100%;
            height:100%;
            overflow:hidden;
        }
    </style>
    <script>
        var app = {
            init: function () {
                var loader = new THREE.ColladaLoader();
                //loader.options.convertUpAxis = true;
                loader.load('/model/model.dae', function (collada) {
                    app.model = collada.scene;
                    app.model.scale.x = app.model.scale.y = app.model.scale.z = 50;
                    app.model.position.set(-9, 4, 40);
                    app.model.rotation.set(0, 1.5, 6.3);
                    app.model.updateMatrix();
                    var textureLoader = new THREE.TextureLoader();
                    textureLoader.load('/model/initialShadingGroup1_normal.jpg', function (normalMap) {
                        textureLoader.load('/model/initialShadingGroup1_roughness.jpg', function (bumpMap) {
                            textureLoader.load('/model/initialShadingGroup1_metallic.jpg', function (lightMap) {
                                textureLoader.load('/model/initialShadingGroup1_metallic.jpg', function (aoMap) {
                                    app.model.children[1].children["0"].material.normalMap = normalMap;
                                    app.model.children[1].children["0"].material.bumpMap = bumpMap;
                                    app.model.children[1].children["0"].material.bumpScale = 15;
                                    app.model.children[1].children["0"].material.lightMap = lightMap;
                                    app.model.children[1].children["0"].material.lightMapIntensity = 15;
                                    app.model.children[1].children["0"].material.aoMap = aoMap;
                                    app.model.children[1].children["0"].material.aoMapIntensity = 1;
                                    app.setup.init();
                                    app.render();
                                });
                            });
                        });
                    });
                });
            },
            setup: {
                init: function () {
                    this.scene();
                    this.camera();
                    this.controls();
                    this.lights();
                    //this.geometry();
                    //this.material();
                    this.mesh();
                    this.renderer();
                    this.gui.init();
                },
                scene: function () {
                    app.scene = new THREE.Scene();
                    //app.scene.background = new THREE.Color(0x3c3c3c);
                },
                camera: function () {
                    app.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
                    app.camera.position.z = 100;
                },
                controls: function () {
                    app.controls = new THREE.TrackballControls(app.camera);
                    app.controls.rotateSpeed = 2.0;
                    app.controls.zoomSpeed = 2.2;
                    app.controls.panSpeed = 1.8;
                    app.controls.noZoom = false;
                    app.controls.noPan = false;
                    app.controls.staticMoving = true;
                    app.controls.dynamicDampingFactor = 0.3;
                    app.controls.keys = [65, 83, 68];
                },
                lights: function () {
                    // Directional Light
                    app.directionalLight = new THREE.DirectionalLight(0x8e8d8d);
                    app.directionalLight.position.set(0, 1, 0);		
                    app.directionalLight.castShadow = true;          
                    app.scene.add(app.directionalLight);
                    // Spotlight 1
                    app.spotLight1 = new THREE.SpotLight(0x404040);
                    app.spotLight1.position.set(-6, 18, 100);
                    app.spotLight1.intensity = 0.65;
                    app.spotLight1.castShadow = true;
                    app.scene.add(app.spotLight1);
                    // pointlight 1
                    app.pointLight1 = new THREE.PointLight(0xc86812, 1, 100);
                    app.pointLight1.position.set(-9, -13, 33);
                    app.pointLight1.intensity = 1;
                    app.pointLight1.decay = 0.5;
                    app.pointLight1.dir = true;
                    app.scene.add(app.pointLight1);
                    var sphereSize = 1;
                    var pointLightHelper = new THREE.PointLightHelper(app.pointLight1, sphereSize);
                    app.scene.add(pointLightHelper);
                    // Spotlight 2
                    app.pointLight2 = new THREE.SpotLight(0xc86812); 
                },
                geometry: function () {
                    //app.geometry = new THREE.BoxGeometry(20, 20, 20);
                },
                material: function () {
                    //app.material = new THREE.MeshPhongMaterial({ shading: THREE.SmoothShading, color: new THREE.Color(0x2194ce) });
                },
                mesh: function () {
                    //app.scene.add(new THREE.Mesh(app.geometry, app.material));
                    app.scene.add(app.model);
                },
                renderer: function () {
                    app.renderer = new THREE.WebGLRenderer({ antialias: true });
                    app.renderer.setSize(window.innerWidth, window.innerHeight);
                    document.body.appendChild(app.renderer.domElement);
                    // Set Anisotropic filtering
                    app.model.children[1].children["0"].material.map.anisotropy = app.renderer.getMaxAnisotropy();
                },
                gui: {
                    init: function () {
                        this.vars.init();
                        this.gui.init();
                        this.events();
                    },
                    vars: {
                        init: function () {
                            app.gui = {};
                            app.gui.axe = new this.axe();
                            app.gui.lights = new this.lights();
                            app.gui.lightToggles = new this.lightToggles();
                        },
                        axe: function () {
                            this.rotateX = app.model.rotation.x;
                            this.rotateY = app.model.rotation.y;
                            this.rotateZ = app.model.rotation.z;
                            this.autoRotate = false;
                            this.X = app.model.position.x;
                            this.Y = app.model.position.y;
                            this.Z = app.model.position.z;
                        },
                        lights: function () {
                            this.SL1X = app.pointLight1.position.x;
                            this.SL1Y = app.pointLight1.position.y;
                            this.SL1Z = app.pointLight1.position.z;
                            this.SL1RX = app.pointLight1.rotation.x;
                            this.SL1RY = app.pointLight1.rotation.y;
                            this.SL1RZ = app.pointLight1.rotation.z;
                            this.SL1Color = '#c86812';
                            this.SL1Intensity = 1;
                            this.Distance = app.pointLight1.distance;
                            this.Decay = app.pointLight1.decay
                        },
                        lightToggles: function () {
                            this.directionalLight = true;
                            this.spotLight1 = true;
                            this.pointLight1 = true;
                        }
                    },
                    gui: {
                        init: function() {
                            this.gui = new dat.GUI();
                            this.axe();
                            this.lights();
                            this.lightToggles();
                        },
                        axe: function () {
                            var axe = this.gui.addFolder('Axe Mesh');
                            axe.add(app.gui.axe, 'rotateX', 0, 10);
                            axe.add(app.gui.axe, 'rotateY', 0, 10);
                            axe.add(app.gui.axe, 'rotateZ', 0, 10);
                            axe.add(app.gui.axe, 'X', -100, 100);
                            axe.add(app.gui.axe, 'Y', -100, 100);
                            axe.add(app.gui.axe, 'Z', -100, 100);
                            axe.add(app.gui.axe, 'autoRotate');
                        },
                        lights: function () {
                            var lights = this.gui.addFolder('Lights');
                            lights.add(app.gui.lights, 'SL1X', -100, 100);
                            lights.add(app.gui.lights, 'SL1Y', -100, 100);
                            lights.add(app.gui.lights, 'SL1Z', -100, 100);
                            lights.add(app.gui.lights, 'SL1RX', 0, 1);
                            lights.add(app.gui.lights, 'SL1RY', 0, 1);
                            lights.add(app.gui.lights, 'SL1RZ', 0, 1);
                            lights.addColor(app.gui.lights, 'SL1Color');
                            lights.add(app.gui.lights, 'SL1Intensity', 0, 1);
                            lights.add(app.gui.lights, 'Distance', -300, 300);
                            lights.add(app.gui.lights, 'Decay', 0, 100);
                        },
                        lightToggles: function () {
                            var lightToggles = this.gui.addFolder('Toggle Lights')
                            lightToggles.add(app.gui.lightToggles, 'directionalLight');
                            lightToggles.add(app.gui.lightToggles, 'spotLight1');
                            lightToggles.add(app.gui.lightToggles, 'pointLight1');
                        }
                    }, 
                    events: function () {
                        var el = document.getElementsByClassName('dg')[0];
                        el.addEventListener('mouseover', function () {
                            app.controls.enabled = false;
                        });
                        el.addEventListener('mouseleave', function () {
                            app.controls.enabled = true;
                        });
                    }
                }
            },
            render: function () {
                requestAnimationFrame(app.render);
                if (typeof app.model !== 'undefined') {
                    if (!app.gui.axe.autoRotate) {
                        app.model.rotation.set(app.gui.axe.rotateX, app.gui.axe.rotateY, app.gui.axe.rotateZ);
                    } else {
                        app.model.rotation.x += 0.01;
                        app.model.rotation.y += 0.01;
                        app.model.rotation.z += 0.01;
                    }
                    app.model.position.set(app.gui.axe.X, app.gui.axe.Y, app.gui.axe.Z);
                }

                app.pointLight1.position.set(app.gui.lights.SL1X, app.gui.lights.SL1Y, app.gui.lights.SL1Z);
                app.pointLight1.rotation.set(app.gui.lights.SL1RX, app.gui.lights.SL1RY, app.gui.lights.SL1RZ);
                app.pointLight1.color = new THREE.Color(app.gui.lights.SL1Color);
                app.pointLight1.intensity = app.gui.lights.SL1Intensity;
                app.pointLight1.distance = app.gui.lights.Distance;
                //app.pointLight1.decay = app.gui.lights.Decay;
                app.controls.update();

                app.directionalLight.visible = app.gui.lightToggles.directionalLight;
                app.spotLight1.visible = app.gui.lightToggles.spotLight1;
                app.pointLight1.visible = app.gui.lightToggles.pointLight1;

                // Flickering flame
                if (Math.round(Math.random())) {
                    if (app.pointLight1.dir) {
                        app.pointLight1.decay += 0.05;
                    } else {
                        app.pointLight1.decay -= 0.05;
                    }
                    if (app.pointLight1.decay > 1.5 || app.pointLight1.decay < 0.5) {
                        app.pointLight1.dir = !app.pointLight1.dir;
                    }
                }
                //if (Math.round(Math.random())) {
                //    if (app.spotLight2.dir) {
                //        app.spotLight2.intensity += 0.005;
                //    } else {
                //        app.spotLight2.intensity -= 0.005;
                //    }
                //    if (app.spotLight2.dir2) {
                //        app.spotLight2.position.x += 0.2;
                //    } else {
                //        app.spotLight2.position.x -= 0.2;
                //    }
                //    if (app.spotLight2.dir3) {
                //        app.spotLight2.position.z += 0.1;
                //    } else {
                //        app.spotLight2.position.z -= 0.1;
                //    }
                //    if (app.spotLight2.intensity > 0.5 || app.spotLight2.intensity < 0) {
                //        app.spotLight2.dir = !app.spotLight2.dir;
                //    }
                //    if (app.spotLight2.position.x < -100 || app.spotLight2.position.x > 100) {
                //        app.spotLight2.dir2 = !app.spotLight2.dir2;
                //    }
                //    if (app.spotLight2.position.z < -40 || app.spotLight2.position.z > 30) {
                //        app.spotLight2.dir3 = !app.spotLight2.dir3;
                //    }
                //}

                app.renderer.render(app.scene, app.camera)
            }
        }

        window.addEventListener('DOMContentLoaded', function () {
            app.init();
        })
    </script>
</head>
<body>

</body>
</html>
